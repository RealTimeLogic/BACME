<?lsp

if request:header"x-requested-with" then
   local enabled = request:data"autoReg" == "true"
   db.setAutoReg(zoneT.zid,enabled)
   response:json{autoReg=enabled}
end

?>
<section class="content">
<div class="card card-primary">
<div class="card-body">
   <table class="table table-bordered">
   <tr><td>Owner:</td><td><?lsp=zoneT.admEmail?></td></tr>
   <tr><td>Registered:</td><td><?lsp=zoneT.regTime?></td></tr>
   <tr>
     <td><span>Auto Registration:</span></td>
     <td>
       <input data-toggle="tooltip" title="Enable automatic account registration without requiring administrator acceptance" type="checkbox" id="autoReg" name="autoReg" <?lsp=db.getAutoReg(zoneT.zid) and "checked" or ""?>>
     </td>
   </tr>
   <tr><td>Devices:</td><td><?lsp=db.countDevices4Zone(zoneT.zid)?></td></tr>
   <tr><td>Zone Key:</td><td><?lsp=zoneT.zkey?></td></tr>

   <tr><td>Secret:</td><td>
<?lsp
 local session = request:session() 
 if session.verification and session.verification == request:data"verification" then
    print(zoneT.zsecret)
    session.verification=nil
 else
   print'<a href="verification.html">View secret</a>'
 end
?>
   </td></tr>
   </table>
</div>
</div>
</section>
<script>
    $("#autoReg").click(function() {
        $.getJSON(window.location,{autoReg:$(this).prop("checked")});
    });
</script>
